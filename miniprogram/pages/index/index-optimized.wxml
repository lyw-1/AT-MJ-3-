<view class="page">
  <!-- å›ºå®šé¡¶éƒ¨å®¹å™¨ - ä¼˜åŒ–é«˜åº¦ -->
  <view class="fixed-header">
    <!-- æœç´¢æ  -->
    <view class="search-bar">
      <image class="search-icon" src="/assets/icons/search.svg"></image>
      <text class="search-text">æœç´¢</text>
    </view>
    
    <!-- å¿«æ·æ“ä½œæŒ‰é’® -->
    <view class="quick-actions-section">
      <view class="quick-actions-header">
        <text class="quick-actions-title">å¿«æ·æ“ä½œ</text>
        <view class="quick-actions-manage" bindtap="toggleManageMode">
          <image src="/assets/icons/settings.svg" style="width: 32rpx; height: 32rpx; filter: brightness(0) invert(0.6);"></image>
        </view>
      </view>
      
      <scroll-view class="quick-actions-scroll" scroll-x="true" enable-flex="true" show-scrollbar="false">
        <view class="quick-actions">
          <view class="action-item" wx:for="{{currentQuickActions}}" wx:key="id" data-id="{{item.id}}" bindtap="onActionTap">
            <image class="action-icon" src="{{item.icon}}" style="background-color: {{item.color}}"></image>
            <text class="action-text">{{item.name}}</text>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- é¡µé¢å†…å®¹ -->
  <view class="page-content">
    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <view class="stats-grid">
      <view class="stat-card" bindtap="viewMoldPassRate" style="background-color: {{stats.moldPassRate.color}}">
        <text class="stat-value">{{stats.moldPassRate.value}}%</text>
        <text class="stat-label">{{stats.moldPassRate.label}}</text>
      </view>
      <view class="stat-card" bindtap="viewBareMoldCount" style="background-color: {{stats.bareMoldCount.color}}">
        <text class="stat-value">{{stats.bareMoldCount.value}}</text>
        <text class="stat-label">{{stats.bareMoldCount.label}}</text>
      </view>
      <view class="stat-card" bindtap="viewAvailableCount" style="background-color: {{stats.availableCount.color}}">
        <text class="stat-value">{{stats.availableCount.value}}</text>
        <text class="stat-label">{{stats.availableCount.label}}</text>
      </view>
      <view class="stat-card" bindtap="viewLockedCount" style="background-color: {{stats.lockedCount.color}}">
        <text class="stat-value">{{stats.lockedCount.value}}</text>
        <text class="stat-label">{{stats.lockedCount.label}}</text>
      </view>
    </view>

    <!-- æ¨¡å…·åŠ å·¥ä»»åŠ¡åˆ—è¡¨ -->
    <view class="function-module">
      <view class="module-header">
        <text class="module-title">æ¨¡å…·åŠ å·¥ä»»åŠ¡</text>
        <text class="module-more" bindtap="viewMoreMoldTasks">å…¨éƒ¨</text>
      </view>
      <view class="module-content">
        <view class="task-item" wx:for="{{moldProcessTasks}}" wx:key="id" data-id="{{item.id}}" bindtap="viewMoldTaskDetail">
          <view class="task-item-left">
            <text class="task-item-name">{{item.moldName}}</text>
            <view class="task-item-status {{item.status === 'è¿›è¡Œä¸­' ? 'status-processing' : item.status === 'å¾…å¤„ç†' ? 'status-pending' : 'status-completed'}}">{{item.status}}</view>
          </view>
          <text class="task-item-date">{{item.dueDate}}</text>
        </view>
        <view wx:if="{{moldProcessTasks.length === 0}}" class="empty-state">
          <view class="empty-icon">ğŸ“‹</view>
          <text class="empty-title">æš‚æ— ä»»åŠ¡</text>
          <text class="empty-desc">å½“å‰æ²¡æœ‰æ¨¡å…·åŠ å·¥ä»»åŠ¡</text>
        </view>
      </view>
    </view>

    <!-- éæ¨¡å…·åŠ å·¥ä»»åŠ¡åˆ—è¡¨ -->
    <view class="function-module">
      <view class="module-header">
        <text class="module-title">éæ¨¡å…·åŠ å·¥ä»»åŠ¡</text>
        <text class="module-more" bindtap="viewMoreNonMoldTasks">å…¨éƒ¨</text>
      </view>
      <view class="module-content">
        <view class="task-item" wx:for="{{nonMoldProcessTasks}}" wx:key="id" data-id="{{item.id}}" bindtap="viewNonMoldTaskDetail">
          <view class="task-item-left">
            <text class="task-item-name">{{item.taskName}}</text>
            <view class="task-item-status {{item.status === 'è¿›è¡Œä¸­' ? 'status-processing' : item.status === 'å¾…å¤„ç†' ? 'status-pending' : 'status-completed'}}">{{item.status}}</view>
          </view>
          <text class="task-item-date">{{item.dueDate}}</text>
        </view>
        <view wx:if="{{nonMoldProcessTasks.length === 0}}" class="empty-state">
          <view class="empty-icon">ğŸ“‹</view>
          <text class="empty-title">æš‚æ— ä»»åŠ¡</text>
          <text class="empty-desc">å½“å‰æ²¡æœ‰éæ¨¡å…·åŠ å·¥ä»»åŠ¡</text>
        </view>
      </view>
    </view>

    <!-- æœ€è¿‘æˆå‹è®°å½• -->
    <view class="function-module">
      <view class="module-header">
        <text class="module-title">æœ€è¿‘æˆå‹è®°å½•</text>
        <text class="module-more" bindtap="viewMoreProductionData">å…¨éƒ¨</text>
      </view>
      <view class="module-content">
        <view class="data-item" wx:for="{{recentProductionData}}" wx:key="id" data-id="{{item.id}}" bindtap="viewProductionDataDetail">
          <view class="data-item-left">
            <text class="data-item-name">{{item.productName}}</text>
            <text class="data-item-operator">{{item.operator}}</text>
          </view>
          <text class="data-item-time">{{item.time}}</text>
        </view>
        <view wx:if="{{recentProductionData.length === 0}}" class="empty-state">
          <view class="empty-icon">ğŸ“Š</view>
          <text class="empty-title">æš‚æ— è®°å½•</text>
          <text class="empty-desc">å½“å‰æ²¡æœ‰æˆå‹è®°å½•</text>
        </view>
      </view>
    </view>

  </view>

  <!-- è‡ªå®šä¹‰æ˜¾ç¤ºåŠŸèƒ½æ¨¡æ€æ¡† -->
  <view class="modal-mask" wx:if="{{isManageMode}}" bindtap="toggleManageMode"></view>
  <view class="modal-content" wx:if="{{isManageMode}}">
    <view class="modal-header">
      <text class="modal-title">è‡ªå®šä¹‰å¿«æ·åŠŸèƒ½</text>
      <view class="modal-close" bindtap="toggleManageMode">Ã—</view>
    </view>
    <view class="modal-tabs">
      <text class="modal-tab {{!isSortMode ? 'active' : ''}}" bindtap="toggleSortMode">æ˜¾ç¤º/éšè—</text>
      <text class="modal-tab {{isSortMode ? 'active' : ''}}" bindtap="toggleSortMode">æ’åº</text>
    </view>
    <view class="modal-body">
      <!-- æ˜¾ç¤º/éšè—æ¨¡å¼ -->
      <view class="action-manage-list" wx:if="{{!isSortMode}}">
        <view class="action-manage-item" wx:for="{{allQuickActions}}" wx:key="id" data-id="{{item.id}}" bindtap="toggleActionShow">
          <view class="action-manage-info">
            <image class="action-manage-icon" src="{{item.icon}}" style="background-color: {{item.color}}"></image>
            <text class="action-manage-name">{{item.name}}</text>
          </view>
          <view class="action-manage-switch {{item.show ? 'active' : ''}}">
            <view class="switch-button"></view>
          </view>
        </view>
      </view>
      <!-- æ’åºæ¨¡å¼ -->
      <view class="action-sort-list" wx:if="{{isSortMode}}">
        <view class="action-sort-item" wx:for="{{allQuickActions}}" wx:key="id" wx:for-index="index" data-index="{{index}}"
              bindlongpress="onLongPressItem" bindtouchstart="onTouchStart" bindtouchmove="onTouchMove" bindtouchend="onTouchEnd"
              style="opacity: {{draggedIndex === index ? 0.5 : 1}};">
          <view class="sort-handle">â˜°</view>
          <view class="action-manage-info">
            <image class="action-manage-icon" src="{{item.icon}}" style="background-color: {{item.color}}"></image>
            <text class="action-manage-name">{{item.name}}</text>
          </view>
          <view class="sort-indicator">{{draggedIndex === index ? 'æ‹–åŠ¨ä¸­' : ''}}</view>
        </view>
      </view>
      <view class="sort-tip" wx:if="{{isSortMode}}">
        <text>é•¿æŒ‰å¹¶æ‹–åŠ¨é¡¹ç›®æ¥æ’åº</text>
      </view>
    </view>
  </view>
</view>
