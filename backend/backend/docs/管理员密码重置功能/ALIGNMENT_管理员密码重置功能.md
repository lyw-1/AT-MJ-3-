# 管理员密码重置功能需求对齐文档

## 1. 项目上下文分析

### 1.1 现有项目结构
- **框架**: Spring Boot 2.7 + Spring Security
- **ORM**: MyBatis Plus
- **安全**: JWT + 角色权限控制
- **日志**: 操作审计日志系统

### 1.2 相关组件
- UserController: 处理用户相关API请求，包含密码重置接口
- UserServiceImpl: 实现用户服务，包含resetPassword方法
- OperationLog: 操作日志实体，用于记录敏感操作
- PasswordResetRequest: 密码重置请求DTO
- ResetPasswordResult: 密码重置结果DTO

## 2. 需求理解确认

### 2.1 原始需求
管理员可以重置用户密码，支持自定义密码或使用默认密码，并记录详细的操作日志。

### 2.2 边界确认
- **功能边界**: 仅管理员角色可执行密码重置操作
- **权限边界**: 使用@PreAuthorize("hasRole('ADMIN')")进行权限控制
- **数据边界**: 密码长度限制在8-20个字符

### 2.3 需求理解
- **核心功能**: 管理员重置用户密码
- **操作类型**: 可选自定义密码或动态默认密码（随机生成，符合密码规则）
- **日志记录**: 记录详细的操作日志，包括操作者、IP、操作内容等
- **事务控制**: 密码重置操作需要事务保证一致性

### 2.4 疑问澄清
- 默认密码格式：采用随机动态生成（仅字母数字且包含两类），并在响应中返回给管理员；日志系统按照敏感字段规则进行脱敏
- 密码复杂度要求：当前只检查长度，建议增加复杂度验证
- 密码重置后的通知机制：当前未实现通知功能，建议增加通知机制

## 3. 技术实现规范

### 3.1 接口规范
- RESTful API: `POST /api/users/{id}/reset-password`
- 请求体: PasswordResetRequest（包含可选的newPassword字段）
- 响应: ResetPasswordResult（包含userId、resetTime、defaultPassword标志）

### 3.2 安全规范
- 密码加密：使用PasswordEncoder进行密码加密存储
- 操作审计：标记为敏感操作，级别为high
- 权限控制：严格的管理员权限验证

### 3.3 数据规范
- 用户不存在时返回404错误
- 密码重置失败时返回500错误
- 操作日志必须包含完整的上下文信息
