# 工序模板配置功能迁移计划

## 需求分析
将系统中所有与工序设置相关的模板配置功能模块，完整迁移至工序管理功能模块中，实现模板创建、编辑、删除、查询等所有操作在工序管理功能内统一完成。同时保持从模具初始参数页面的工序路线入口（设置工序预设）能携带模具基本数据，而工序管理模块用于设置通用模板。

## 当前系统结构

1. **路由结构**：
   - 工序管理：`/mold/process`（已移动到加工管理内部）
   - 工序预设（模板配置）：`/mold/process-preset/:id`（属于加工管理模块，用于特定模具的工序设置）

2. **API结构**：
   - 工序预设相关API在 `mold.ts` 文件中，路径为 `/process-preset`
   - 工序管理相关API在 `process.ts` 文件中

3. **组件结构**：
   - 工序预设组件：`ProcessPresetPage.vue`（位于 `/pages/mold/` 目录下，用于特定模具的工序设置）
   - 工序管理组件：`ProcessDetail.vue`、`MaterialPreparation.vue`（位于 `/pages/process/` 目录下）

## 迁移方案

### 1. 路由配置调整
**文件**: `d:/trae/AT-MJ-3/frontend/frontend/src/router/index.ts`

- **新增模板管理路由**：在工序管理模块下新增模板管理路由，用于设置通用工序模板
- **保留现有路由**：保持 `/mold/process-preset/:id` 路由不变，用于从模具初始参数页面进入，携带模具基本数据
- **新增路由**：
  - 路径: `/mold/process/template`
  - 名称: `ProcessTemplate`
  - 组件: `ProcessTemplatePage.vue`（新创建，用于通用模板管理）

### 2. 组件调整
**文件**: 
- `d:/trae/AT-MJ-3/frontend/frontend/src/pages/mold/ProcessPresetPage.vue`
- `d:/trae/AT-MJ-3/frontend/frontend/src/pages/process/ProcessTemplatePage.vue`（新创建）

- **保留现有组件**：保持 `ProcessPresetPage.vue` 组件不变，继续用于从模具初始参数页面进入的场景
- **新增模板组件**：创建 `ProcessTemplatePage.vue` 组件，用于工序管理模块下的通用模板管理
- **组件复用**：尽量复用 `ProcessPresetPage.vue` 中的逻辑，通过 props 区分两种使用场景

### 3. API调整
**文件**: 
- `d:/trae/AT-MJ-3/frontend/frontend/src/api/mold.ts`
- `d:/trae/AT-MJ-3/frontend/frontend/src/api/process.ts`

- **保持API不变**：`process-preset` 相关的API继续留在 `mold.ts` 中，供两种场景使用
- **新增模板API**：在 `process.ts` 中新增通用模板管理API，路径为 `/process/template`
- **统一数据结构**：确保两种场景使用相同的数据结构，便于数据共享和迁移

### 4. 菜单配置更新

- **新增模板管理菜单**：在工序管理菜单下新增模板管理子菜单
- **保持现有菜单**：加工管理模块下的工序路线入口保持不变
- **权限控制**：确保两种场景的权限控制一致

## 预期效果

1. **功能分离**：
   - 从模具初始参数页面进入：`/mold/process-preset/:id` → 携带模具基本数据，用于特定模具的工序设置
   - 从工序管理进入：`/mold/process/template` → 用于设置通用工序模板

2. **数据共享**：
   - 通用模板可以应用到特定模具
   - 特定模具的工序设置可以保存为通用模板
   - 保持数据一致性和完整性

3. **功能统一**：
   - 所有模板相关操作在工序管理功能内统一完成
   - 提供模板创建、编辑、删除、查询、应用等功能
   - 支持模板版本管理和历史记录

## 风险评估

1. **数据一致性问题**：
   - 风险：两种场景使用不同的数据结构可能导致数据不一致
   - 缓解：设计统一的数据结构，确保数据共享和迁移顺利

2. **路由冲突问题**：
   - 风险：新增路由可能与现有路由冲突
   - 缓解：仔细设计路由路径，确保唯一性

3. **组件复用问题**：
   - 风险：组件复用可能导致逻辑复杂
   - 缓解：使用 props 区分场景，保持组件逻辑清晰

4. **权限控制问题**：
   - 风险：两种场景的权限控制可能不一致
   - 缓解：统一权限管理，确保权限控制一致

## 验证步骤

1. **功能验证**：
   - 测试从模具初始参数页面进入工序预设功能，验证模具基本数据是否正确携带
   - 测试从工序管理进入模板管理功能，验证通用模板管理是否正常
   - 测试模板创建、编辑、删除、查询等功能
   - 测试模板应用到特定模具的功能

2. **数据验证**：
   - 验证模板数据一致性
   - 测试模板版本管理功能
   - 验证数据导入导出功能

3. **界面验证**：
   - 检查界面布局是否正常
   - 验证交互体验是否流畅
   - 测试响应式设计

4. **权限验证**：
   - 验证不同角色的权限控制
   - 测试权限继承和覆盖

## 代码修改点

1. **路由配置**：修改 `router/index.ts`，新增模板管理路由
2. **组件创建**：创建 `ProcessTemplatePage.vue` 组件
3. **API新增**：在 `process.ts` 中新增通用模板管理API
4. **组件调整**：调整 `ProcessPresetPage.vue`，支持两种使用场景
5. **菜单配置**：更新菜单配置，新增模板管理菜单

## 迁移顺序

1. 设计统一的数据结构
2. 创建 `ProcessTemplatePage.vue` 组件
3. 新增模板管理API
4. 更新路由配置
5. 调整菜单配置
6. 测试两种使用场景
7. 进行全面测试

## 预期效果

通过以上迁移方案，实现了：
1. 工序模板配置功能的统一管理
2. 保留了从模具初始参数页面进入的便捷性
3. 支持通用模板和特定模具模板的双重管理
4. 保持了数据一致性和完整性
5. 提供了良好的用户体验